会议纪要

技术分享：专家部署与故障恢复方案

1. 近期进展更新  
   • 动态专家自动部署均衡功能已提交至 master 分支，支持共享专家和路由专家的分类部署场景。  

   • 模型测试支持扩展：已支持 DeepSeek-R1 和 Kimi K2 的 POC 验证，纤维系支持正在开发中。

2. 故障恢复方案背景  
   • 多机协同推理系统中，规模扩大导致单点故障概率上升（如 NPU 故障），恢复时间延长。  

   • 故障类型包括单卡故障、节点故障、实例故障及组网故障，需结合并行域处理放大影响。

3. 故障检测与处理架构  
   • Global 控制面：新增系统级功能检测（如 Token 异常检查）、决策流程及故障处理机制。  

   • 推理进程内：通过 Agent 实时感知推理错误，区分严重错误（需隔离）与非严重错误（可恢复异常）。  

   • 硬件支持：提供硬件状态检测、通信动态调整能力。

4. 故障处理流程  
   • 检测阶段：  

     ◦ Worker 内即时捕获推理错误，严重错误直接隔离。  

     ◦ 调度层兜底检测 Token 超时等异常，触发硬件自检后决策隔离或忽略。  

   • 处理阶段：  

     ◦ P 实例：整实例剔除，剩余实例接管请求。  

     ◦ D 实例：清理故障现场、专家迁移、通信算子动态缩减、调度视图刷新。  

5. 专家处理

6. 通信域动态支持  
   • 故障后需重建通信域，区分路由节点与非路由节点处理。  

   • EP 通信特殊支持：通过 dispatch 算子实现动态收容，确保剩余卡继续服务。  

7. 性能与挑战  
   • 故障检测分层：进程内快速感知（毫秒级）与调度层兜底（秒级）。  

   • 当前限制：按并行域隔离（如 8 卡一起剔除），可能导致吞吐下降；全局通信域动态调整尚未支持。

8. 后续计划  
   • 细化故障处理设计，持续同步进展。  

   • 开放社区讨论（微信群/社区），收集专家负载均衡等方向的改进建议。  

问答摘要

• 故障恢复范围：当前方案针对实例内 NPU 故障，按域隔离（如 8 卡），剩余卡收容而非补卡。  

• 检测延迟：进程内错误即时感知，硬件隐性问题依赖调度层兜底（可能延迟至秒级）。

### 会议录屏

本次会议录屏可在[社区B站](https://www.bilibili.com/video/BV1sitzzuEek/)中查看